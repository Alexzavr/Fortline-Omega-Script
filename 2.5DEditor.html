<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.5D Grid Editor</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 0;
    }
    #controls {
      margin: 1rem;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(20, 30px);
      grid-template-rows: repeat(20, 30px);
      gap: 1px;
      background-color: #333;
    }
    .cell {
      width: 30px;
      height: 30px;
      background-color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 10px;
      cursor: pointer;
    }
    .filled {
      background-color: #4caf50;
      color: white;
    }
  </style>
</head>
<body>
  <div id="controls">
    <label>Model: <input type="text" id="modelInput" value="Wall$0$0" /></label>
    <label>Y Layer: <input type="number" id="yInput" min="0" max="99" value="0" /></label>
    <button onclick="exportLua()">Export Lua</button>
  </div>
  <div id="grid"></div>

  <script>
    const grid = document.getElementById("grid");
    const modelInput = document.getElementById("modelInput");
    const yInput = document.getElementById("yInput");
    const placed = {}; // key = "x,z,y" => model name

    for (let y = 0; y < 20 * 20; y++) {
      const cell = document.createElement("div");
      const x = y % 20;
      const z = Math.floor(y / 20);
      cell.classList.add("cell");
      cell.dataset.x = x;
      cell.dataset.z = z;
      cell.innerText = "";

      cell.addEventListener("click", () => {
        const model = modelInput.value;
        const layerY = parseInt(yInput.value);
        const key = `${x},${layerY},${z}`;

        if (placed[key]) {
          delete placed[key];
          cell.classList.remove("filled");
          cell.innerText = "";
        } else {
          placed[key] = model;
          cell.classList.add("filled");
          cell.innerText = model.split("$")[0];
        }
      });

      grid.appendChild(cell);
    }

    function exportLua() {
      let lua = "";
      for (const key in placed) {
        const [x, y, z] = key.split(",").map(Number);
        const model = placed[key];
        lua += `Build("${model}", ${x}, ${y}, ${z})\n`;
      }
      const blob = new Blob([lua], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "build.lua";
      a.click();
    }
  </script>
</body>
</html>
