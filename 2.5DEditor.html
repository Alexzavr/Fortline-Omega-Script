<!DOCTYPE html>
        }
      }

      for (const key in grid) {
        const [gx, gy, gz] = key.split(',').map(Number);
        if (gy !== getLayer()) continue;

        const models = grid[key];

        for (const model of models) {
          if (model.startsWith("Wall$")) {
            const angle = parseInt(model.split('$')[1]);
            ctx.strokeStyle = "#00f";
            ctx.lineWidth = 2;

            const x1 = gx * cellSize;
            const y1 = gz * cellSize;
            const x2 = x1 + cellSize;
            const y2 = y1 + cellSize;

            ctx.beginPath();
            if (angle === 0) {
              ctx.moveTo(x2 - 1, y1 + 5);
              ctx.lineTo(x2 - 1, y2 - 5);
            } else if (angle === 90) {
              ctx.moveTo(x1 + 5, y1 + 1);
              ctx.lineTo(x2 - 5, y1 + 1);
            } else if (angle === 180) {
              ctx.moveTo(x1 + 1, y1 + 5);
              ctx.lineTo(x1 + 1, y2 - 5);
            } else if (angle === 270) {
              ctx.moveTo(x1 + 5, y2 - 1);
              ctx.lineTo(x2 - 5, y2 - 1);
            } else {
              ctx.fillStyle = "#00f";
              ctx.fillRect(x1 + 8, y1 + 8, cellSize - 16, cellSize - 16);
            }
            ctx.stroke();
          }
        }
      }
    }

    function exportLua() {
      let lua = '';
      for (const key in grid) {
        const [x, y, z] = key.split(',').map(Number);
        for (const model of grid[key]) {
          lua += `Build("${model}", ${x}, ${y}, ${z})\n`;
        }
      }
      const blob = new Blob([lua], {type: "text/plain"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "export.lua";
      link.click();
    }

    drawGrid();
  </script>
</body>
</html>

