<!DOCTYPE html>
<html>
<head>
  <title>2.5D Grid Editor</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
      color: white;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background: #222;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 2;
    }
    button, input {
      margin: 5px;
    }
  </style>
</head>
<body>
  <div id="ui">
    Layer: <input id="layer" type="number" min="0" max="99" value="0">
    <button onclick="exportLua()">Export</button>
  </div>
  <canvas id="editor"></canvas>

  <script>
    const canvas = document.getElementById("editor");
    const ctx = canvas.getContext("2d");
    const gridSize = 20;
    const cellSize = 32;
    const layers = Array.from({ length: 100 }, () => ({}));
    let currentLayer = 0;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    document.getElementById("layer").oninput = (e) => {
      currentLayer = parseInt(e.target.value);
      draw();
    };

    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) / cellSize);
      const z = Math.floor((e.clientY - rect.top) / cellSize);
      const key = `${x},${z}`;

      const layer = layers[currentLayer];
      if (layer[key]) {
        delete layer[key];
      } else {
        layer[key] = "Wall$0$0";
      }
      draw();
    });

    function drawGrid() {
      ctx.strokeStyle = "#444";
      for (let x = 0; x <= gridSize; x++) {
        ctx.beginPath();
        ctx.moveTo(x * cellSize, 0);
        ctx.lineTo(x * cellSize, gridSize * cellSize);
        ctx.stroke();
      }
      for (let z = 0; z <= gridSize; z++) {
        ctx.beginPath();
        ctx.moveTo(0, z * cellSize);
        ctx.lineTo(gridSize * cellSize, z * cellSize);
        ctx.stroke();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGrid();

      const layer = layers[currentLayer];
      for (const key in layer) {
        const [x, z] = key.split(",").map(Number);
        ctx.fillStyle = "#66ccff";
        ctx.fillRect(x * cellSize + 1, z * cellSize + 1, cellSize - 2, cellSize - 2);
      }
    }

    function exportLua() {
      let lua = "";
      for (let y = 0; y < layers.length; y++) {
        for (const key in layers[y]) {
          const [x, z] = key.split(",").map(Number);
          const model = layers[y][key];
          lua += `Build("${model}", ${x}, ${y}, ${z})\n`;
        }
      }
      console.log(lua);
      alert("Lua script copied to console");
    }

    draw();
  </script>
</body>
</html>
